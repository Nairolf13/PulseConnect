{% extends "../layouts/base.twig" %}

{% block style %}
	<link rel="stylesheet" href="/../../assets/css/collaboration.css">
{% endblock %}

{% block title %}
	<title>{{ title }}</title>
{% endblock %}

{% block main %}
	{% include "../partials/header.twig" %}
	<section class="main-content">
		<div class="feed-container">
			<h1>{{ project.name }}</h1>
			<p>{{ project.description }}</p>
			<div class="file-feed">
				{% for file in project.files %}
					<div class="file-item">
						{% if file.url %}
							<div class="file-info">
								<strong>{{ file.name }}</strong>
								<p>{{ file.description }}</p>
							</div>
							{% if file.url ends with '.mp3' or file.url ends with '.wav' %}
								<audio controls>
									<source src="/uploads/{{ file.url }}" type="audio/mpeg">
									Votre navigateur ne supporte pas l'élément audio.
								</audio>
							{% elseif file.url ends with '.mp4' or file.url ends with '.avi' %}
								<video controls>
									<source src="/uploads/{{ file.url }}" type="video/mp4">
									Votre navigateur ne supporte pas l'élément vidéo.
								</video>
							{% else %}
								<div id="picture">
									<img src="/uploads/{{ file.url }}" target="_blank" alt="image partagé">
								</div><br>
							{% endif %}

							<div class="comments" id="comments-{{ file.id }}" style="display: none;">
								<h4>Commentaires</h4>
								{% if file.comments is defined and file.comments is not empty %}
									<ul>
										{% for comment in file.comments %}
											<li class="commentaire">
												<strong>{{ comment.userName }}</strong>
												<p>{{ comment.content }}</p>
												{{ comment.created_at | date("d/m/Y") }}
											</li>
										{% endfor %}
									</ul>
								{% else %}
									<p>Aucun commentaire pour ce fichier.</p>
								{% endif %}
								<form id="formComment" action="/project/{{ project.id_project }}/{{ file.id }}/comment" method="POST">
									<textarea id="textComment" name="commentContent" placeholder="Ajouter un commentaire" required></textarea><br>
									<button type="submit">Commenter</button>
								</form>
							</div>
							<button class="toggle-comments-btn" id="btn-toggle-{{ file.id }}" onclick="toggleComments({{ file.id }})">Afficher les commentaires</button>

						{% endif %}
					</div>
				{% endfor %}
			</div>
		</div>

		<div class="sidebar-container">
			<div class="members-list">
				<h3>Participants</h3>
				<ul>
					{% for member in project.members %}
						<li>
							<img src="{{ member.picture }}" alt="Avatar">
							<strong>{{ member.userName }}</strong>
							({{ member.role }})
						</li>
					{% endfor %}
				</ul>
				<form action="/project/{{ project.id_project }}/upload" method="POST" enctype="multipart/form-data">
					<h3>Ajouter un fichier</h3>
					<div id="textTitle">
						<label for="name"></label>
						<input id="name" name="name" placeholder="Titre" required>
					</div>
					<div>
						<label for="genre"></label>
						<select id="genre" name="genre" required>
							<option value="" disabled selected>Sélectionnez un genre</option>
							{% for genre in genres %}
								<option value="{{ genre }}">{{ genre }}
								</option>
							{% endfor %}
						</select>
					</div>
					<textarea type="text" name="description" placeholder="Description"></textarea><br>
					<input type="file" name="file" required><br>
					<button type="submit">Ajouter</button>
				</form>
			</div>
		</div>
		<button id="toggle-sidebar-btn" class="toggle-sidebar-btn" onclick="toggleSidebar()">...</button>
	</section>
	{% include "../partials/error.twig" %}
{% endblock %}
{% block script %}
	<script src="/../../assets/js/collaboration.js"></script>
{% endblock %}
