{% extends "../layouts/base.twig" %}

{% block style %}
	<link rel="stylesheet" href="/../../assets/css/studio.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css">
{% endblock %}

{% block title %}
	<title>{{ title }}</title>
{% endblock %}

{% block main %}
	{% include "../partials/header.twig" %}
	<div class="header">
		<li>
			<a href="/home" class="back-arrow"><img src="/../../assets/imgs/flecheBack.png" alt="arrowBack"></a>
		</li>
		<h1>Les studios</h1>
	</div>
	<div id="search-container">
		<input type="text" id="search" placeholder="Rechercher un studio (nom, ville, pays)"/>
		<button onclick="searchStudio()">Rechercher</button>
	</div>
	<div id="map"></div>
	<div id="loading" class="loading">Chargement des studios...</div>
	<div id="errorModal" class="modal">
		<div class="modal-content">
			
			<p id="errorMessage"></p>
		</div>
	</div>
{% endblock %}


{% block script %}
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script src="/../../assets/js/studio.js"></script>
<script>
				const studios = {{ studios|json_encode|raw }};
		
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
		    maxZoom: 19,
		    attribution: '© OpenStreetMap contributors'
		}).addTo(map);
		
		const markers = L.markerClusterGroup();
		
		studios.forEach(studio => {
	    const marker = L.marker([studio.latitude, studio.longitude]);
	    const address = studio.address || 'Adresse non spécifiée';
	    const phone = studio.phone ? `<a href="tel:${studio.phone}">Appeler ${studio.phone}</a>` : 'Numéro de téléphone non disponible';
	
	  let popupContent = `
	    <b>${studio.name}</b><br>
	    ${address}<br>
	    ${phone ? `<a href="tel:${studio.phone}">Appeler ${studio.phone}</a>` : 'Numéro de téléphone non disponible'}
	`;
	    marker.bindPopup(popupContent);
	    markers.addLayer(marker);
	});
		
		map.addLayer(markers);
			</script>
		{% endblock %}
